<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="jenna cheo">
<meta name="dcterms.date" content="2024-10-15">

<title>take home exercise 3 â€“ IS415-GAA</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">IS415-GAA</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-hands-on-exercise" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Hands-on Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-hands-on-exercise">    
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex01.html">
 <span class="dropdown-text">Hands-on Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex02.html">
 <span class="dropdown-text">Hands-on Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex03.html">
 <span class="dropdown-text">Hands-on Exercise 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex05.html">
 <span class="dropdown-text">Hands-on Exercise 5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex06.html">
 <span class="dropdown-text">Hands-on Exercise 6</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex08.html">
 <span class="dropdown-text">Hands-on Exercise 8</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex09.html">
 <span class="dropdown-text">Hands-on Exercise 9</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex10.html">
 <span class="dropdown-text">Hands-on Exercise 10</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex11.html">
 <span class="dropdown-text">Hands-on Exercise 11</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex12.html">
 <span class="dropdown-text">Hands-on Exercise 12</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-in-class-exercise" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">In-class Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-in-class-exercise">    
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex01.html">
 <span class="dropdown-text">In-class Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex02.html">
 <span class="dropdown-text">In-class Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex03.html">
 <span class="dropdown-text">In-class Exercise 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex04.html">
 <span class="dropdown-text">In-class Exercise 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex05.html">
 <span class="dropdown-text">In-class Exercise 5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex09.html">
 <span class="dropdown-text">In-class Exercise 6</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex10.html">
 <span class="dropdown-text">In-class Exercise 10</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex11.html">
 <span class="dropdown-text">In-class Exercise 11</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex12.html">
 <span class="dropdown-text">In-class Exercise 12</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-take-home-exercise" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Take-home Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-take-home-exercise">    
        <li>
    <a class="dropdown-item" href="../../Take-home_Ex/1/Take-home_Ex01.html">
 <span class="dropdown-text">Take-home Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Take-home_Ex/2/Take-home_Ex02.html">
 <span class="dropdown-text">Take-home Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Take-home_Ex/3/Take-home_Ex03.html">
 <span class="dropdown-text">Take-home Exercise 3</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">1. Introduction</a></li>
  <li><a href="#ui" id="toc-ui" class="nav-link" data-scroll-target="#ui">2. UI</a></li>
  <li><a href="#importing-data-and-packages-into-r" id="toc-importing-data-and-packages-into-r" class="nav-link" data-scroll-target="#importing-data-and-packages-into-r">3. Importing data and packages into R</a>
  <ul class="collapse">
  <li><a href="#datasets-being-used" id="toc-datasets-being-used" class="nav-link" data-scroll-target="#datasets-being-used">3.1 Datasets being used</a></li>
  <li><a href="#wrangling" id="toc-wrangling" class="nav-link" data-scroll-target="#wrangling">3.2 Wrangling</a>
  <ul class="collapse">
  <li><a href="#data-preparation" id="toc-data-preparation" class="nav-link" data-scroll-target="#data-preparation">3.2.1 Data Preparation</a></li>
  <li><a href="#checking-for-mismatch-state" id="toc-checking-for-mismatch-state" class="nav-link" data-scroll-target="#checking-for-mismatch-state">3.2.2 Checking for Mismatch (State)</a></li>
  <li><a href="#cleaning-state" id="toc-cleaning-state" class="nav-link" data-scroll-target="#cleaning-state">3.2.3 Cleaning (State)</a></li>
  <li><a href="#crime-state-district" id="toc-crime-state-district" class="nav-link" data-scroll-target="#crime-state-district">3.2.4 Crime (State-District)</a></li>
  <li><a href="#population-state-district" id="toc-population-state-district" class="nav-link" data-scroll-target="#population-state-district">3.2.5 Population (State-District)</a></li>
  <li><a href="#joining" id="toc-joining" class="nav-link" data-scroll-target="#joining">3.2.6 Joining</a></li>
  <li><a href="#visualizing-the-distribution-of-crime" id="toc-visualizing-the-distribution-of-crime" class="nav-link" data-scroll-target="#visualizing-the-distribution-of-crime">3.2.7 Visualizing the distribution of crime</a></li>
  </ul></li>
  <li><a href="#global-measures-of-spatial-autocorrelation" id="toc-global-measures-of-spatial-autocorrelation" class="nav-link" data-scroll-target="#global-measures-of-spatial-autocorrelation">3.4 Global Measures of Spatial Autocorrelation</a>
  <ul class="collapse">
  <li><a href="#computing-contiguity-spatial-weights" id="toc-computing-contiguity-spatial-weights" class="nav-link" data-scroll-target="#computing-contiguity-spatial-weights">3.4.1 Computing Contiguity Spatial Weights</a></li>
  <li><a href="#morans-i-test" id="toc-morans-i-test" class="nav-link" data-scroll-target="#morans-i-test">3.4.2 Moranâ€™s I test</a></li>
  <li><a href="#gearys-c-test" id="toc-gearys-c-test" class="nav-link" data-scroll-target="#gearys-c-test">3.4.3 Gearyâ€™s C test</a></li>
  </ul></li>
  <li><a href="#local-measures-of-spatial-autocorrelation" id="toc-local-measures-of-spatial-autocorrelation" class="nav-link" data-scroll-target="#local-measures-of-spatial-autocorrelation">3.5 Local Measures of Spatial Autocorrelation</a>
  <ul class="collapse">
  <li><a href="#computing-local-morans-i" id="toc-computing-local-morans-i" class="nav-link" data-scroll-target="#computing-local-morans-i">3.5.1 Computing Local Moranâ€™s I</a></li>
  <li><a href="#lisa-classification" id="toc-lisa-classification" class="nav-link" data-scroll-target="#lisa-classification">3.5.2 LISA Classification</a></li>
  </ul></li>
  <li><a href="#hot-and-cold-spots-analysis-hcsa" id="toc-hot-and-cold-spots-analysis-hcsa" class="nav-link" data-scroll-target="#hot-and-cold-spots-analysis-hcsa">3.6 Hot and Cold Spots Analysis (HCSA)</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">4. Conclusion</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">take home exercise 3</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>jenna cheo </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 15, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introduction" class="level1">
<h1>1. Introduction</h1>
<p>This study investigates the spatial distribution and evolution of crime in Malaysia over recent years. By employing advanced spatial analysis techniques, we aim to identify hotspots, coldspots, and emerging trends in crime patterns. Our analysis utilizes a comprehensive dataset of crime incidents, including location, type, and date of occurrence.</p>
<p>The exercise will focus only on one page consisting of all portions that I am responsible for. This includes:</p>
<ul>
<li><p>Global Spatial Autocorrelation (Moranâ€™s I)</p></li>
<li><p>Local Spatial Autocorrelation (Local Moranâ€™s I - LISA Map)</p></li>
</ul>
</section>
<section id="ui" class="level1">
<h1>2. UI</h1>
<p>The results would be displayed in a map using Shiny App, and the initial proposed layout is as followed:</p>
<p><img src="images/clipboard-500690992.png" class="img-fluid"></p>
<p>To insert the user input specifications and controls, Shiny has functions like <code>sliderInput()</code>, <code>selectInput()</code>, <code>textInput()</code>, <code>numericInput()</code>, <code>checkboxInput()</code>, and <code>checkboxGroupInput()</code>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/Screenshot 2024-03-20 at 9.02.23 PM.png" class="img-fluid figure-img" width="551"></p>
<figcaption>Image taken from <a href="https://www.paulamoraga.com/book-geospatial/sec-shiny.html">Dr.&nbsp;Paula Moraga</a></figcaption>
</figure>
</div>
</section>
<section id="importing-data-and-packages-into-r" class="level1">
<h1>3. Importing data and packages into R</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(sf, st, tidyverse, raster, tmap, tmaptools, ggplot2, spatstat, sfdep, spdep)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="datasets-being-used" class="level2">
<h2 class="anchored" data-anchor-id="datasets-being-used">3.1 Datasets being used</h2>
<p>There are three datasets being used in this exercise.</p>
<ul>
<li><p><a href="https://data.gov.my/data-catalogue/crime_district">Malaysia â€“ Crime by District and Crime Type</a> from data.gov.my in csv format.</p></li>
<li><p><a href="https://data.gov.my/data-catalogue/population_district">Malaysia - Population Table: Administrative Districts</a> from data.gov.my in csv format.</p></li>
<li><p><a href="https://data.humdata.org/dataset/cod-ab-mys">Malaysia - Subnational Administrative Boundaries</a> with included administrative regions in shapefile format.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>crime_df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/aspatial/crime_district.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 19152 Columns: 6
â”€â”€ Column specification â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Delimiter: ","
chr  (4): state, district, category, type
dbl  (1): crimes
date (1): date

â„¹ Use `spec()` to retrieve the full column specification for this data.
â„¹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>population_df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/aspatial/population_district.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 319200 Columns: 7
â”€â”€ Column specification â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Delimiter: ","
chr  (5): state, district, sex, age, ethnicity
dbl  (1): population
date (1): date

â„¹ Use `spec()` to retrieve the full column specification for this data.
â„¹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<p>Next, we import the administrative regions of Malaysia.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>mys_sf <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="at">dsn =</span> <span class="st">"data/geospatial/mys_adm_unhcr_20210211_shp"</span>, </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">layer =</span> <span class="st">"mys_admbnda_adm2_unhcr_20210211"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>          <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3168</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="wrangling" class="level2">
<h2 class="anchored" data-anchor-id="wrangling">3.2 Wrangling</h2>
<section id="data-preparation" class="level3">
<h3 class="anchored" data-anchor-id="data-preparation">3.2.1 Data Preparation</h3>
<p>We first identify the states in each dataset to pick out any inconsistencies to resolve.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Unique states in crime_df:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Unique states in crime_df:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(crime_df<span class="sc">$</span>state)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Malaysia"          "Johor"             "Kedah"            
 [4] "Kelantan"          "Melaka"            "Negeri Sembilan"  
 [7] "Pahang"            "Perak"             "Perlis"           
[10] "Pulau Pinang"      "Sabah"             "Sarawak"          
[13] "Selangor"          "Terengganu"        "W.P. Kuala Lumpur"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Unique states in population_df:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Unique states in population_df:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(crime_df<span class="sc">$</span>state)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Malaysia"          "Johor"             "Kedah"            
 [4] "Kelantan"          "Melaka"            "Negeri Sembilan"  
 [7] "Pahang"            "Perak"             "Perlis"           
[10] "Pulau Pinang"      "Sabah"             "Sarawak"          
[13] "Selangor"          "Terengganu"        "W.P. Kuala Lumpur"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Unique states in mys_sf:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Unique states in mys_sf:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(mys_sf<span class="sc">$</span>ADM1_EN)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Johor"             "Kedah"             "Kelantan"         
 [4] "W.P. Kuala Lumpur" "W.P. Labuan"       "Melaka"           
 [7] "Negeri Sembilan"   "Pahang"            "Perak"            
[10] "Perlis"            "Pulau Pinang"      "Sabah"            
[13] "Sarawak"           "Terengganu"        "W.P. Putrajaya"   
[16] "Selangor"         </code></pre>
</div>
</div>
<p>We then convert the state and district columns to upper case for matching.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>crime_df <span class="ot">&lt;-</span> crime_df <span class="sc">%&gt;%</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>              <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">year</span>(date),</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">state =</span> <span class="fu">toupper</span>(state),</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">district =</span> <span class="fu">toupper</span>(district))</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>crime_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 19,152 Ã— 7
   state    district category type           date       crimes  year
   &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;          &lt;date&gt;      &lt;dbl&gt; &lt;dbl&gt;
 1 MALAYSIA ALL      assault  all            2016-01-01  22327  2016
 2 MALAYSIA ALL      assault  all            2017-01-01  21366  2017
 3 MALAYSIA ALL      assault  all            2018-01-01  16902  2018
 4 MALAYSIA ALL      assault  all            2019-01-01  16489  2019
 5 MALAYSIA ALL      assault  all            2020-01-01  13279  2020
 6 MALAYSIA ALL      assault  all            2021-01-01  11495  2021
 7 MALAYSIA ALL      assault  all            2022-01-01  10348  2022
 8 MALAYSIA ALL      assault  all            2023-01-01  10453  2023
 9 MALAYSIA ALL      assault  causing_injury 2016-01-01   5531  2016
10 MALAYSIA ALL      assault  causing_injury 2017-01-01   5024  2017
# â„¹ 19,142 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>population_df <span class="ot">&lt;-</span> population_df <span class="sc">%&gt;%</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>              <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">year</span>(date),</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">state =</span> <span class="fu">toupper</span>(state),</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">district =</span> <span class="fu">toupper</span>(district))</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>population_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 319,200 Ã— 8
   state district   date       sex   age     ethnicity        population  year
   &lt;chr&gt; &lt;chr&gt;      &lt;date&gt;     &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;                 &lt;dbl&gt; &lt;dbl&gt;
 1 JOHOR BATU PAHAT 2020-01-01 both  overall overall               495.   2020
 2 JOHOR BATU PAHAT 2020-01-01 both  overall bumi_malay            311.   2020
 3 JOHOR BATU PAHAT 2020-01-01 both  overall bumi_other              5.1  2020
 4 JOHOR BATU PAHAT 2020-01-01 both  overall chinese               140.   2020
 5 JOHOR BATU PAHAT 2020-01-01 both  overall indian                  6.9  2020
 6 JOHOR BATU PAHAT 2020-01-01 both  overall other_citizen           1.8  2020
 7 JOHOR BATU PAHAT 2020-01-01 both  overall other_noncitizen       30.2  2020
 8 JOHOR BATU PAHAT 2020-01-01 both  0-4     overall                30.3  2020
 9 JOHOR BATU PAHAT 2020-01-01 both  0-4     bumi_malay             21.3  2020
10 JOHOR BATU PAHAT 2020-01-01 both  0-4     bumi_other              0.5  2020
# â„¹ 319,190 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>mys_sf <span class="ot">&lt;-</span> mys_sf <span class="sc">%&gt;%</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">ADM1_EN =</span> <span class="fu">toupper</span>(ADM1_EN),</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ADM2_EN =</span> <span class="fu">toupper</span>(ADM2_EN))</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>mys_sf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 144 features and 14 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 184853.1 ymin: 94420.8 xmax: 2380932 ymax: 829136
Projected CRS: Kertau (RSO) / RSO Malaya (m)
# A tibble: 144 Ã— 15
   ADM2_EN  ADM2_PCODE ADM2_REF ADM2ALT1EN ADM2ALT2EN ADM1_EN ADM1_PCODE ADM0_EN
 * &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;   &lt;chr&gt;      &lt;chr&gt;  
 1 BATU PAâ€¦ MY0101     &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;       JOHOR   MY01       Malaysâ€¦
 2 JOHOR Bâ€¦ MY0102     &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;       JOHOR   MY01       Malaysâ€¦
 3 KLUANG   MY0103     &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;       JOHOR   MY01       Malaysâ€¦
 4 KOTA TIâ€¦ MY0104     &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;       JOHOR   MY01       Malaysâ€¦
 5 KULAIJAâ€¦ MY0105     &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;       JOHOR   MY01       Malaysâ€¦
 6 LEDANG   MY0106     &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;       JOHOR   MY01       Malaysâ€¦
 7 MERSING  MY0107     &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;       JOHOR   MY01       Malaysâ€¦
 8 MUAR     MY0108     &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;       JOHOR   MY01       Malaysâ€¦
 9 PONTIAN  MY0109     &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;       JOHOR   MY01       Malaysâ€¦
10 SEGAMAT  MY0110     &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;       JOHOR   MY01       Malaysâ€¦
# â„¹ 134 more rows
# â„¹ 7 more variables: ADM0_PCODE &lt;chr&gt;, date &lt;date&gt;, validOn &lt;date&gt;,
#   validTo &lt;date&gt;, Shape_Leng &lt;dbl&gt;, Shape_Area &lt;dbl&gt;,
#   geometry &lt;MULTIPOLYGON [m]&gt;</code></pre>
</div>
</div>
</section>
<section id="checking-for-mismatch-state" class="level3">
<h3 class="anchored" data-anchor-id="checking-for-mismatch-state">3.2.2 Checking for Mismatch (State)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming you have two character vectors:</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>state_crime <span class="ot">&lt;-</span> <span class="fu">unique</span>(crime_df<span class="sc">$</span>state)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>state_sf <span class="ot">&lt;-</span> <span class="fu">unique</span>(mys_sf<span class="sc">$</span>ADM1_EN)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Find states in crime_df that are not in mys_sf</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>missing_in_sf <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(state_crime, state_sf)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Find states in mys_sf that are not in crime_df</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>missing_in_crime <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(state_sf, state_crime)</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the mismatches</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"States in crime_df not found in mys_sf:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "States in crime_df not found in mys_sf:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(missing_in_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "MALAYSIA"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"States in mys_sf not found in crime_df:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "States in mys_sf not found in crime_df:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(missing_in_crime)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "W.P. LABUAN"    "W.P. PUTRAJAYA"</code></pre>
</div>
</div>
</section>
<section id="cleaning-state" class="level3">
<h3 class="anchored" data-anchor-id="cleaning-state">3.2.3 Cleaning (State)</h3>
<p>In this case study, for ease of analysis, we choose to focus on West Malaysia, and thus will be filtering out Sarawak, Sabah and Labuan, which are not the focus of our current analysis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>mys_sf <span class="ot">&lt;-</span> mys_sf <span class="sc">%&gt;%</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>          <span class="fu">filter</span>(ADM1_EN <span class="sc">!=</span> <span class="st">'W.P. LABUAN'</span> <span class="sc">&amp;</span> ADM1_EN <span class="sc">!=</span> <span class="st">'SABAH'</span> <span class="sc">&amp;</span> ADM1_EN <span class="sc">!=</span> <span class="st">'SARAWAK'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">ADM1_EN =</span> <span class="fu">replace</span>(ADM1_EN, ADM1_EN <span class="sc">==</span> <span class="st">'W.P. KUALA LUMPUR'</span>, <span class="st">'KUALA LUMPUR'</span>),</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ADM1_EN =</span> <span class="fu">replace</span>(ADM1_EN, ADM1_EN <span class="sc">==</span> <span class="st">'W.P. PUTRAJAYA'</span>, <span class="st">'KUALA LUMPUR'</span>))</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>mys_sf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 87 features and 14 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 184853.1 ymin: 139843.3 xmax: 728635.8 ymax: 744607.2
Projected CRS: Kertau (RSO) / RSO Malaya (m)
# A tibble: 87 Ã— 15
   ADM2_EN  ADM2_PCODE ADM2_REF ADM2ALT1EN ADM2ALT2EN ADM1_EN ADM1_PCODE ADM0_EN
 * &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;   &lt;chr&gt;      &lt;chr&gt;  
 1 BATU PAâ€¦ MY0101     &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;       JOHOR   MY01       Malaysâ€¦
 2 JOHOR Bâ€¦ MY0102     &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;       JOHOR   MY01       Malaysâ€¦
 3 KLUANG   MY0103     &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;       JOHOR   MY01       Malaysâ€¦
 4 KOTA TIâ€¦ MY0104     &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;       JOHOR   MY01       Malaysâ€¦
 5 KULAIJAâ€¦ MY0105     &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;       JOHOR   MY01       Malaysâ€¦
 6 LEDANG   MY0106     &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;       JOHOR   MY01       Malaysâ€¦
 7 MERSING  MY0107     &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;       JOHOR   MY01       Malaysâ€¦
 8 MUAR     MY0108     &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;       JOHOR   MY01       Malaysâ€¦
 9 PONTIAN  MY0109     &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;       JOHOR   MY01       Malaysâ€¦
10 SEGAMAT  MY0110     &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;       JOHOR   MY01       Malaysâ€¦
# â„¹ 77 more rows
# â„¹ 7 more variables: ADM0_PCODE &lt;chr&gt;, date &lt;date&gt;, validOn &lt;date&gt;,
#   validTo &lt;date&gt;, Shape_Leng &lt;dbl&gt;, Shape_Area &lt;dbl&gt;,
#   geometry &lt;MULTIPOLYGON [m]&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>crime_df <span class="ot">&lt;-</span> crime_df <span class="sc">%&gt;%</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>              <span class="fu">filter</span>(state <span class="sc">!=</span> <span class="st">'MALAYSIA'</span> <span class="sc">&amp;</span> state <span class="sc">!=</span> <span class="st">'SABAH'</span> <span class="sc">&amp;</span> state <span class="sc">!=</span> <span class="st">'SARAWAK'</span> <span class="sc">&amp;</span> </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>                     district <span class="sc">!=</span> <span class="st">'ALL'</span> <span class="sc">&amp;</span> type <span class="sc">!=</span> <span class="st">'all'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>              <span class="fu">mutate</span>(<span class="at">state =</span> <span class="fu">replace</span>(state, state <span class="sc">==</span> <span class="st">'W.P. KUALA LUMPUR'</span>, <span class="st">'KUALA LUMPUR'</span>))</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>crime_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10,368 Ã— 7
   state district   category type           date       crimes  year
   &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;          &lt;date&gt;      &lt;dbl&gt; &lt;dbl&gt;
 1 JOHOR BATU PAHAT assault  causing_injury 2016-01-01     39  2016
 2 JOHOR BATU PAHAT assault  causing_injury 2017-01-01     41  2017
 3 JOHOR BATU PAHAT assault  causing_injury 2018-01-01     28  2018
 4 JOHOR BATU PAHAT assault  causing_injury 2019-01-01     41  2019
 5 JOHOR BATU PAHAT assault  causing_injury 2020-01-01     43  2020
 6 JOHOR BATU PAHAT assault  causing_injury 2021-01-01     22  2021
 7 JOHOR BATU PAHAT assault  causing_injury 2022-01-01     19  2022
 8 JOHOR BATU PAHAT assault  causing_injury 2023-01-01     22  2023
 9 JOHOR BATU PAHAT assault  murder         2016-01-01      6  2016
10 JOHOR BATU PAHAT assault  murder         2017-01-01      0  2017
# â„¹ 10,358 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>population_df <span class="ot">&lt;-</span> population_df <span class="sc">%&gt;%</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>          <span class="fu">filter</span>(state <span class="sc">!=</span> <span class="st">'SABAH'</span> <span class="sc">&amp;</span> state <span class="sc">!=</span> <span class="st">'SARAWAK'</span> <span class="sc">&amp;</span> state <span class="sc">!=</span> <span class="st">'W.P. LABUAN'</span> <span class="sc">&amp;</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>                 sex <span class="sc">==</span> <span class="st">"both"</span> <span class="sc">&amp;</span> age <span class="sc">==</span> <span class="st">"overall"</span> <span class="sc">&amp;</span> ethnicity <span class="sc">==</span> <span class="st">"overall"</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">state =</span> <span class="fu">replace</span>(state, state <span class="sc">==</span> <span class="st">'W.P. KUALA LUMPUR'</span>, <span class="st">'KUALA LUMPUR'</span>),</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">state =</span> <span class="fu">replace</span>(state, state <span class="sc">==</span> <span class="st">'W.P. PUTRAJAYA'</span>, <span class="st">'KUALA LUMPUR'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">select</span>(state, district, year, population)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>population_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 276 Ã— 4
   state district     year population
   &lt;chr&gt; &lt;chr&gt;       &lt;dbl&gt;      &lt;dbl&gt;
 1 JOHOR BATU PAHAT   2020      495. 
 2 JOHOR JOHOR BAHRU  2020     1711. 
 3 JOHOR KLUANG       2020      324. 
 4 JOHOR KOTA TINGGI  2020      222. 
 5 JOHOR KULAI        2020      330. 
 6 JOHOR MERSING      2020       78.2
 7 JOHOR MUAR         2020      315. 
 8 JOHOR PONTIAN      2020      173. 
 9 JOHOR SEGAMAT      2020      198. 
10 JOHOR TANGKAK      2020      163. 
# â„¹ 266 more rows</code></pre>
</div>
</div>
</section>
<section id="crime-state-district" class="level3">
<h3 class="anchored" data-anchor-id="crime-state-district">3.2.4 Crime (State-District)</h3>
<section id="checking-for-mismatch-in-crime_df-and-mys_sf" class="level4">
<h4 class="anchored" data-anchor-id="checking-for-mismatch-in-crime_df-and-mys_sf">3.2.4.1 Checking for Mismatch in crime_df and mys_sf</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>crime_df <span class="ot">&lt;-</span> crime_df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">state_district =</span> <span class="fu">paste</span>(state, district, <span class="at">sep =</span> <span class="st">"-"</span>))</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>mys_sf <span class="ot">&lt;-</span> mys_sf <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">state_district =</span> <span class="fu">paste</span>(ADM1_EN, ADM2_EN, <span class="at">sep =</span> <span class="st">"-"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming you have two character vectors:</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>state_district_crime <span class="ot">&lt;-</span> <span class="fu">unique</span>(crime_df<span class="sc">$</span>state_district)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>state_district_sf <span class="ot">&lt;-</span> <span class="fu">unique</span>(mys_sf<span class="sc">$</span>state_district)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Find mismatches</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>missing_in_sf <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(state_district_crime, state_district_sf)</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>missing_in_crime <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(state_district_sf, state_district_crime)</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the mismatches</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"State-District combinations in crime_df not found in mys_sf:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "State-District combinations in crime_df not found in mys_sf:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(missing_in_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "JOHOR-ISKANDAR PUTERI"               "JOHOR-JOHOR BAHRU SELATAN"          
 [3] "JOHOR-JOHOR BAHRU UTARA"             "JOHOR-NUSAJAYA"                     
 [5] "JOHOR-SERI ALAM"                     "KEDAH-BANDAR BHARU"                 
 [7] "NEGERI SEMBILAN-NILAI"               "PAHANG-CAMERON HIGHLAND"            
 [9] "PAHANG-KUALA LIPIS"                  "PERAK-BATU GAJAH"                   
[11] "PERAK-GERIK"                         "PERAK-IPOH"                         
[13] "PERAK-MANJUNG"                       "PERAK-PENGKALAN HULU"               
[15] "PERAK-SELAMA"                        "PERAK-SUNGAI SIPUT"                 
[17] "PERAK-TAIPING"                       "PERAK-TANJONG MALIM"                
[19] "PERAK-TAPAH"                         "PERLIS-ARAU"                        
[21] "PERLIS-KANGAR"                       "PERLIS-PADANG BESAR"                
[23] "PULAU PINANG-SEBERANG PERAI SELATAN" "PULAU PINANG-SEBERANG PERAI TENGAH" 
[25] "PULAU PINANG-SEBERANG PERAI UTARA"   "SELANGOR-AMPANG JAYA"               
[27] "SELANGOR-HULU SELANGOR"              "SELANGOR-KAJANG"                    
[29] "SELANGOR-KLANG SELATAN"              "SELANGOR-KLANG UTARA"               
[31] "SELANGOR-PETALING JAYA"              "SELANGOR-SERDANG"                   
[33] "SELANGOR-SG. BULOH"                  "SELANGOR-SHAH ALAM"                 
[35] "SELANGOR-SUBANG JAYA"                "SELANGOR-SUNGAI BULOH"              
[37] "KUALA LUMPUR-BRICKFIELDS"            "KUALA LUMPUR-CHERAS"                
[39] "KUALA LUMPUR-DANG WANGI"             "KUALA LUMPUR-SENTUL"                
[41] "KUALA LUMPUR-WANGSA MAJU"           </code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"State-District combinations in mys_sf not found in crime_df:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "State-District combinations in mys_sf not found in crime_df:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(missing_in_crime)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "JOHOR-JOHOR BAHRU"             "KEDAH-POKOK SENA"             
 [3] "KUALA LUMPUR-WP. KUALA LUMPUR" "PAHANG-LIPIS"                 
 [5] "PERAK-BATANG PADANG"           "PERAK-ULU PERAK"              
 [7] "PERAK-KINTA"                   "PERAK-LARUT DAN MATANG"       
 [9] "PERAK-MANJUNG (DINDING)"       "PERLIS-PERLIS"                
[11] "PULAU PINANG-S.P.SELATAN"      "PULAU PINANG-S.P. TENGAH"     
[13] "PULAU PINANG-S.P. UTARA"       "SELANGOR-ULU LANGAT"          
[15] "SELANGOR-ULU SELANGOR"         "SELANGOR-KLANG"               
[17] "SELANGOR-PETALING"            </code></pre>
</div>
</div>
</section>
<section id="cleaning" class="level4">
<h4 class="anchored" data-anchor-id="cleaning">3.2.4.2 Cleaning</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>crime_df <span class="ot">&lt;-</span> crime_df <span class="sc">%&gt;%</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">district =</span> <span class="fu">case_when</span>(</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"JOHOR"</span> <span class="sc">&amp;</span> district <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"ISKANDAR PUTERI"</span>, <span class="st">"NUSAJAYA"</span>, <span class="st">"JOHOR BAHRU SELATAN"</span>, <span class="st">"JOHOR BAHRU UTARA"</span>, <span class="st">"SERI ALAM"</span>) <span class="sc">~</span> <span class="st">"JOHOR BAHRU"</span>,</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"NEGERI SEMBILAN"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"NILAI"</span> <span class="sc">~</span> <span class="st">"SEREMBAN"</span>,</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"KEDAH"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"BANDAR BHARU"</span> <span class="sc">~</span> <span class="st">"BANDAR BAHARU"</span>,</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PAHANG"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"CAMERON HIGHLAND"</span> <span class="sc">~</span> <span class="st">"CAMERON HIGHLANDS"</span>,</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PAHANG"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"KUALA LIPIS"</span> <span class="sc">~</span> <span class="st">"LIPIS"</span>,</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PERAK"</span> <span class="sc">&amp;</span> district  <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"BATU GAJAH"</span>, <span class="st">"IPOH"</span>) <span class="sc">~</span> <span class="st">"KINTA"</span>,</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PERAK"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"GERIK"</span> <span class="sc">~</span> <span class="st">"ULU PERAK"</span>,</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PERAK"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"MANJUNG"</span> <span class="sc">~</span> <span class="st">"MANJUNG (DINDING)"</span>,</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PERAK"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"PENGKALAN HULU"</span> <span class="sc">~</span> <span class="st">"ULU PERAK"</span>,</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PERAK"</span> <span class="sc">&amp;</span> district <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"SELAMA"</span>, <span class="st">"TAIPING"</span>) <span class="sc">~</span> <span class="st">"LARUT DAN MATANG"</span>,</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PERAK"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"SUNGAI SIPUT"</span> <span class="sc">~</span> <span class="st">"KUALA KANGSAR"</span>,</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PERAK"</span> <span class="sc">&amp;</span> district <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"TANJONG MALIM"</span>, <span class="st">"TAPAH"</span>) <span class="sc">~</span> <span class="st">"BATANG PADANG"</span>,</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PERLIS"</span> <span class="sc">&amp;</span> district <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"ARAU"</span>, <span class="st">"KANGAR"</span>, <span class="st">"PADANG BESAR"</span>) <span class="sc">~</span> <span class="st">"PERLIS"</span>,</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PULAU PINANG"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"SEBERANG PERAI SELATAN"</span> <span class="sc">~</span> <span class="st">"S.P.SELATAN"</span>,</span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PULAU PINANG"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"SEBERANG PERAI TENGAH"</span> <span class="sc">~</span> <span class="st">"S.P. TENGAH"</span>,</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PULAU PINANG"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"SEBERANG PERAI UTARA"</span> <span class="sc">~</span> <span class="st">"S.P. UTARA"</span>,</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"SELANGOR"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"AMPANG JAYA"</span> <span class="sc">~</span> <span class="st">"GOMBAK"</span>,</span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"SELANGOR"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"HULU SELANGOR"</span> <span class="sc">~</span> <span class="st">"ULU SELANGOR"</span>,</span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"SELANGOR"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"KAJANG"</span> <span class="sc">~</span> <span class="st">"ULU LANGAT"</span>,</span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"SELANGOR"</span> <span class="sc">&amp;</span> district <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"KLANG SELATAN"</span>, <span class="st">"KLANG UTARA"</span>) <span class="sc">~</span> <span class="st">"KLANG"</span>,</span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"SELANGOR"</span> <span class="sc">&amp;</span> district <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"PETALING JAYA"</span>, <span class="st">"SERDANG"</span>, <span class="st">"SG. BULOH"</span>, <span class="st">"SHAH ALAM"</span>, <span class="st">"SUBANG JAYA"</span>, <span class="st">"SUNGAI BULOH"</span>) <span class="sc">~</span> <span class="st">"PETALING"</span>,</span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"KUALA LUMPUR"</span> <span class="sc">&amp;</span> district <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"BRICKFIELDS"</span>, <span class="st">"CHERAS"</span>, <span class="st">"DANG WANGI"</span>, <span class="st">"SENTUL"</span>, <span class="st">"WANGSA MAJU"</span>) <span class="sc">~</span> <span class="st">"WP. KUALA LUMPUR"</span>,</span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> district</span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state, district, year, category, type) <span class="sc">%&gt;%</span></span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">crimes =</span> <span class="fu">sum</span>(crimes))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'state', 'district', 'year', 'category'.
You can override using the `.groups` argument.</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mys_sf) <span class="sc">+</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>() <span class="sc">+</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="st">"ADM2_EN"</span>, <span class="at">size =</span> <span class="fl">0.3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="visualizing-crime-distribution" class="level4">
<h4 class="anchored" data-anchor-id="visualizing-crime-distribution">3.2.4.3 Visualizing Crime Distribution</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>crime_df_mys <span class="ot">&lt;-</span> crime_df <span class="sc">%&gt;%</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2019</span> <span class="sc">&amp;</span> year <span class="sc">&lt;=</span> <span class="dv">2022</span>) <span class="sc">%&gt;%</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(mys_sf, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"state"</span> <span class="ot">=</span> <span class="st">"ADM1_EN"</span>, <span class="st">"district"</span> <span class="ot">=</span> <span class="st">"ADM2_EN"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(state, district, year, category, type, crimes, Shape_Leng, Shape_Area, geometry)</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>crime_df_mys <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(crime_df_mys)</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>crime_df_mys</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 4128 features and 8 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 184853.1 ymin: 139843.3 xmax: 728635.8 ymax: 744607.2
Projected CRS: Kertau (RSO) / RSO Malaya (m)
# A tibble: 4,128 Ã— 9
# Groups:   state, district, year, category [688]
   state district    year category type             crimes Shape_Leng Shape_Area
   &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;             &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;
 1 JOHOR BATU PAHAT  2019 assault  causing_injury       41       1.86      0.161
 2 JOHOR BATU PAHAT  2019 assault  murder                3       1.86      0.161
 3 JOHOR BATU PAHAT  2019 assault  rape                 29       1.86      0.161
 4 JOHOR BATU PAHAT  2019 assault  robbery_gang_arâ€¦      0       1.86      0.161
 5 JOHOR BATU PAHAT  2019 assault  robbery_gang_unâ€¦     37       1.86      0.161
 6 JOHOR BATU PAHAT  2019 assault  robbery_solo_arâ€¦      0       1.86      0.161
 7 JOHOR BATU PAHAT  2019 assault  robbery_solo_unâ€¦     29       1.86      0.161
 8 JOHOR BATU PAHAT  2019 property break_in            157       1.86      0.161
 9 JOHOR BATU PAHAT  2019 property theft_other         127       1.86      0.161
10 JOHOR BATU PAHAT  2019 property theft_vehicle_lâ€¦      4       1.86      0.161
# â„¹ 4,118 more rows
# â„¹ 1 more variable: geometry &lt;MULTIPOLYGON [m]&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>tmap mode set to plotting</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>crime_df_mys_grp <span class="ot">&lt;-</span> crime_df_mys <span class="sc">%&gt;%</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total_crimes =</span> <span class="fu">sum</span>(crimes))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'state', 'district', 'year'. You can
override using the `.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>choro <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(crime_df_mys_grp) <span class="sc">+</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"total_crimes"</span>, </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"pretty"</span>, </span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="st">"Blues"</span>,</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Crimes"</span>) <span class="sc">+</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Distribution of crime in West Malaysia"</span>,</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">1.2</span>,</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.height =</span> <span class="fl">0.45</span>, </span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.width =</span> <span class="fl">0.35</span>,</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type=</span><span class="st">"8star"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>() <span class="sc">+</span></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_grid</span>(<span class="at">alpha =</span><span class="fl">0.2</span>)</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>choro</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="population-state-district" class="level3">
<h3 class="anchored" data-anchor-id="population-state-district">3.2.5 Population (State-District)</h3>
<section id="check-for-mismatch" class="level4">
<h4 class="anchored" data-anchor-id="check-for-mismatch">3.2.5.1 Check for Mismatch</h4>
<p>The year 2019 is missing from the population data set, hence we make the assumption that the population did not experience any drastic increase or decrease, and will thus map population from year 2020 -&gt; 2019.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>population_row <span class="ot">&lt;-</span> population_df <span class="sc">%&gt;%</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2020</span>) <span class="sc">%&gt;%</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="dv">2019</span>) </span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>population_df <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(population_df, population_row) <span class="sc">%&gt;%</span> </span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">state_district =</span> <span class="fu">paste</span>(state, district, <span class="at">sep =</span> <span class="st">"-"</span>))</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(population_df<span class="sc">$</span>year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2020 2021 2022 2019</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>state_district_population <span class="ot">&lt;-</span> <span class="fu">unique</span>(population_df<span class="sc">$</span>state_district)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>missing_in_sf <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(state_district_population, state_district_sf)</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>missing_in_population <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(state_district_sf, state_district_population)</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"State-District combinations in population_df not found in mys_sf:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "State-District combinations in population_df not found in mys_sf:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(missing_in_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "JOHOR-KULAI"                         "JOHOR-TANGKAK"                      
 [3] "KELANTAN-KECIL LOJING"               "PERAK-BAGAN DATUK"                  
 [5] "PERAK-HULU PERAK"                    "PERAK-MANJUNG"                      
 [7] "PERAK-MUALLIM"                       "PERAK-SELAMA"                       
 [9] "PULAU PINANG-SEBERANG PERAI SELATAN" "PULAU PINANG-SEBERANG PERAI TENGAH" 
[11] "PULAU PINANG-SEBERANG PERAI UTARA"   "TERENGGANU-KUALA NERUS"             
[13] "KUALA LUMPUR-W.P. KUALA LUMPUR"      "PAHANG-CAMERON HIGHLAND"            
[15] "PULAU PINANG-SP SELATAN"             "PULAU PINANG-SP TENGAH"             
[17] "PULAU PINANG-SP UTARA"              </code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"State-District combinations in mys_sf not found in population_df:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "State-District combinations in mys_sf not found in population_df:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(missing_in_population)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "JOHOR-KULAIJAYA"               "JOHOR-LEDANG"                 
[3] "KUALA LUMPUR-WP. KUALA LUMPUR" "PERAK-ULU PERAK"              
[5] "PERAK-MANJUNG (DINDING)"       "PULAU PINANG-S.P.SELATAN"     
[7] "PULAU PINANG-S.P. TENGAH"      "PULAU PINANG-S.P. UTARA"      </code></pre>
</div>
</div>
</section>
<section id="cleaning-1" class="level4">
<h4 class="anchored" data-anchor-id="cleaning-1">3.2.5.2 Cleaning</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>population_df <span class="ot">&lt;-</span> population_df <span class="sc">%&gt;%</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">district =</span> <span class="fu">case_when</span>(</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"JOHOR"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"KULAI"</span> <span class="sc">~</span> <span class="st">"KULAIJAYA"</span>,</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"JOHOR"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"TANGKAK"</span> <span class="sc">~</span> <span class="st">"LEDANG"</span>,</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"KELANTAN"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"KECIL LOJING"</span> <span class="sc">~</span> <span class="st">"GUA MUSANG"</span>,</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PAHANG"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"CAMERON HIGHLAND"</span> <span class="sc">~</span> <span class="st">"CAMERON HIGHLANDS"</span>,</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PERAK"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"HULU PERAK"</span> <span class="sc">~</span> <span class="st">"ULU PERAK"</span>,</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PERAK"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"BAGAN DATUK"</span> <span class="sc">~</span> <span class="st">"HILIR PERAK"</span>,</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PERAK"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"MANJUNG"</span> <span class="sc">~</span> <span class="st">"MANJUNG (DINDING)"</span>,</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PERAK"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"MUALLIM"</span> <span class="sc">~</span> <span class="st">"BATANG PADANG"</span>,</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PERAK"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"SELAMA"</span> <span class="sc">~</span> <span class="st">"LARUT DAN MATANG"</span>,</span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PULAU PINANG"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"SEBERANG PERAI SELATAN"</span> <span class="sc">~</span> <span class="st">"S.P.SELATAN"</span>,</span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PULAU PINANG"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"SEBERANG PERAI TENGAH"</span> <span class="sc">~</span> <span class="st">"S.P. TENGAH"</span>,</span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PULAU PINANG"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"SEBERANG PERAI UTARA"</span> <span class="sc">~</span> <span class="st">"S.P. UTARA"</span>,</span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PULAU PINANG"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"SP SELATAN"</span> <span class="sc">~</span> <span class="st">"S.P.SELATAN"</span>,</span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PULAU PINANG"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"SP TENGAH"</span> <span class="sc">~</span> <span class="st">"S.P. TENGAH"</span>,</span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PULAU PINANG"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"SP UTARA"</span> <span class="sc">~</span> <span class="st">"S.P. UTARA"</span>,</span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"KUALA LUMPUR"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"W.P. KUALA LUMPUR"</span> <span class="sc">~</span> <span class="st">"WP. KUALA LUMPUR"</span>,</span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"TERENGGANU"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"KUALA NERUS"</span> <span class="sc">~</span> <span class="st">"KUALA TERENGGANU"</span>,</span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> district</span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state, district, year) <span class="sc">%&gt;%</span></span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">population =</span> <span class="fu">sum</span>(population))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'state', 'district'. You can override using
the `.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>population_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 348 Ã— 4
# Groups:   state, district [87]
   state district     year population
   &lt;chr&gt; &lt;chr&gt;       &lt;dbl&gt;      &lt;dbl&gt;
 1 JOHOR BATU PAHAT   2019       495.
 2 JOHOR BATU PAHAT   2020       495.
 3 JOHOR BATU PAHAT   2021       497.
 4 JOHOR BATU PAHAT   2022       498.
 5 JOHOR JOHOR BAHRU  2019      1711.
 6 JOHOR JOHOR BAHRU  2020      1711.
 7 JOHOR JOHOR BAHRU  2021      1715.
 8 JOHOR JOHOR BAHRU  2022      1724.
 9 JOHOR KLUANG       2019       324.
10 JOHOR KLUANG       2020       324.
# â„¹ 338 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>population_df_mys <span class="ot">&lt;-</span> population_df <span class="sc">%&gt;%</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(mys_sf, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"state"</span> <span class="ot">=</span> <span class="st">"ADM1_EN"</span>, <span class="st">"district"</span> <span class="ot">=</span> <span class="st">"ADM2_EN"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(state, district, year, population, geometry)</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>population_df_mys <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(population_df_mys)</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>population_df_mys</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 348 features and 4 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 184853.1 ymin: 139843.3 xmax: 728635.8 ymax: 744607.2
Projected CRS: Kertau (RSO) / RSO Malaya (m)
# A tibble: 348 Ã— 5
# Groups:   state, district [87]
   state district     year population                                   geometry
   &lt;chr&gt; &lt;chr&gt;       &lt;dbl&gt;      &lt;dbl&gt;                         &lt;MULTIPOLYGON [m]&gt;
 1 JOHOR BATU PAHAT   2019       495. (((556714.6 192051.6, 556664.6 192111.5, â€¦
 2 JOHOR BATU PAHAT   2020       495. (((556714.6 192051.6, 556664.6 192111.5, â€¦
 3 JOHOR BATU PAHAT   2021       497. (((556714.6 192051.6, 556664.6 192111.5, â€¦
 4 JOHOR BATU PAHAT   2022       498. (((556714.6 192051.6, 556664.6 192111.5, â€¦
 5 JOHOR JOHOR BAHRU  2019      1711. (((664760.7 157664.3, 664668.2 157664.3, â€¦
 6 JOHOR JOHOR BAHRU  2020      1711. (((664760.7 157664.3, 664668.2 157664.3, â€¦
 7 JOHOR JOHOR BAHRU  2021      1715. (((664760.7 157664.3, 664668.2 157664.3, â€¦
 8 JOHOR JOHOR BAHRU  2022      1724. (((664760.7 157664.3, 664668.2 157664.3, â€¦
 9 JOHOR KLUANG       2019       324. (((583499.3 195230.8, 581600.3 195991.2, â€¦
10 JOHOR KLUANG       2020       324. (((583499.3 195230.8, 581600.3 195991.2, â€¦
# â„¹ 338 more rows</code></pre>
</div>
</div>
</section>
</section>
<section id="joining" class="level3">
<h3 class="anchored" data-anchor-id="joining">3.2.6 Joining</h3>
<section id="join-with-population-data" class="level4">
<h4 class="anchored" data-anchor-id="join-with-population-data">3.2.6.1 Join with Population Data</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>crime_df_mys <span class="ot">&lt;-</span> crime_df <span class="sc">%&gt;%</span> </span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2019</span> <span class="sc">&amp;</span> year <span class="sc">&lt;=</span> <span class="dv">2022</span>) <span class="sc">%&gt;%</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(population_df, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"state"</span>, <span class="st">"district"</span>, <span class="st">"year"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">crimes_pc =</span> crimes<span class="sc">/</span>population) <span class="sc">%&gt;%</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(state, district, year, category, type, crimes, crimes_pc, population)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="create-for-pokok-sena-district" class="level4">
<h4 class="anchored" data-anchor-id="create-for-pokok-sena-district">3.2.6.2 Create for Pokok Sena District</h4>
<p>Unfortunately, the crime dataset we have sourced did not contain any information on the crimes in Pokok Sena District, possibility due to the scarce population in the area. To resolve this, we have taken the mean of the crime per capita in the neighbouring districts in Kedah State to apply to Pokok Sena.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>pokok_sena_rows <span class="ot">&lt;-</span> crime_df_mys <span class="sc">%&gt;%</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(state <span class="sc">==</span> <span class="st">"KEDAH"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state, year, category, type) <span class="sc">%&gt;%</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">crimes =</span> <span class="fu">mean</span>(crimes),</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">crimes_pc =</span> <span class="fu">mean</span>(crimes_pc),</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">population =</span> <span class="fu">mean</span>(population)) <span class="sc">%&gt;%</span> </span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">district =</span> <span class="st">"POKOK SENA"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'state', 'year', 'category'. You can
override using the `.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>pokok_sena_rows</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 48 Ã— 8
# Groups:   state, year, category [8]
   state  year category type                crimes crimes_pc population district
   &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;                &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;   
 1 KEDAH  2019 assault  causing_injury      29.8    0.140          189. POKOK Sâ€¦
 2 KEDAH  2019 assault  murder               1.82   0.0129         189. POKOK Sâ€¦
 3 KEDAH  2019 assault  rape                13.2    0.0752         189. POKOK Sâ€¦
 4 KEDAH  2019 assault  robbery_gang_armed   0.182  0.00155        189. POKOK Sâ€¦
 5 KEDAH  2019 assault  robbery_gang_unarâ€¦  25.3    0.0992         189. POKOK Sâ€¦
 6 KEDAH  2019 assault  robbery_solo_armed   0.182  0.000410       189. POKOK Sâ€¦
 7 KEDAH  2019 assault  robbery_solo_unarâ€¦  14.7    0.0590         189. POKOK Sâ€¦
 8 KEDAH  2019 property break_in           103.     0.440          189. POKOK Sâ€¦
 9 KEDAH  2019 property theft_other         86.9    0.479          189. POKOK Sâ€¦
10 KEDAH  2019 property theft_vehicle_lorâ€¦   7.09   0.0202         189. POKOK Sâ€¦
# â„¹ 38 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>crime_df_mys <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(crime_df_mys, pokok_sena_rows)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="join-with-district-boundary" class="level4">
<h4 class="anchored" data-anchor-id="join-with-district-boundary">2.3.6.3 Join with District Boundary</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>crime_df_mys <span class="ot">&lt;-</span> crime_df_mys <span class="sc">%&gt;%</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(mys_sf, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"state"</span> <span class="ot">=</span> <span class="st">"ADM1_EN"</span>, <span class="st">"district"</span> <span class="ot">=</span> <span class="st">"ADM2_EN"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(state, district, year, category, type, crimes, crimes_pc, population, geometry)</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>crime_df_mys <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(crime_df_mys)</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>crime_df_mys</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 4176 features and 8 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 184853.1 ymin: 139843.3 xmax: 728635.8 ymax: 744607.2
Projected CRS: Kertau (RSO) / RSO Malaya (m)
# A tibble: 4,176 Ã— 9
# Groups:   state, district, year, category [696]
   state district    year category type              crimes crimes_pc population
   &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
 1 JOHOR BATU PAHAT  2019 assault  causing_injury        41   0.0828        495.
 2 JOHOR BATU PAHAT  2019 assault  murder                 3   0.00606       495.
 3 JOHOR BATU PAHAT  2019 assault  rape                  29   0.0586        495.
 4 JOHOR BATU PAHAT  2019 assault  robbery_gang_armâ€¦      0   0             495.
 5 JOHOR BATU PAHAT  2019 assault  robbery_gang_unaâ€¦     37   0.0747        495.
 6 JOHOR BATU PAHAT  2019 assault  robbery_solo_armâ€¦      0   0             495.
 7 JOHOR BATU PAHAT  2019 assault  robbery_solo_unaâ€¦     29   0.0586        495.
 8 JOHOR BATU PAHAT  2019 property break_in             157   0.317         495.
 9 JOHOR BATU PAHAT  2019 property theft_other          127   0.256         495.
10 JOHOR BATU PAHAT  2019 property theft_vehicle_loâ€¦      4   0.00808       495.
# â„¹ 4,166 more rows
# â„¹ 1 more variable: geometry &lt;MULTIPOLYGON [m]&gt;</code></pre>
</div>
</div>
</section>
</section>
<section id="visualizing-the-distribution-of-crime" class="level3">
<h3 class="anchored" data-anchor-id="visualizing-the-distribution-of-crime">3.2.7 Visualizing the distribution of crime</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>crime_df_mys_grp <span class="ot">&lt;-</span> crime_df_mys <span class="sc">%&gt;%</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state, district) <span class="sc">%&gt;%</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total_crimes_pc =</span> <span class="fu">sum</span>(crimes_pc)<span class="sc">/</span><span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'state'. You can override using the
`.groups` argument.</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>tmap mode set to plotting</code></pre>
</div>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>choro <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(crime_df_mys_grp) <span class="sc">+</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"total_crimes_pc"</span>, </span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">n =</span> <span class="dv">5</span>,</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"equal"</span>, </span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="st">"Blues"</span>,</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Crime per Capita in West Malaysia"</span>) <span class="sc">+</span></span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Crime per Capita Distribution"</span>,</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">1.2</span>,</span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.height =</span> <span class="fl">0.45</span>, </span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.width =</span> <span class="fl">0.35</span>,</span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type=</span><span class="st">"8star"</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">position =</span> <span class="fu">c</span>(<span class="st">"right"</span>, <span class="st">"top"</span>)) <span class="sc">+</span></span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_grid</span>(<span class="at">alpha =</span><span class="fl">0.2</span>)</span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-18"><a href="#cb86-18" aria-hidden="true" tabindex="-1"></a>choro</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="global-measures-of-spatial-autocorrelation" class="level2">
<h2 class="anchored" data-anchor-id="global-measures-of-spatial-autocorrelation">3.4 Global Measures of Spatial Autocorrelation</h2>
<section id="computing-contiguity-spatial-weights" class="level3">
<h3 class="anchored" data-anchor-id="computing-contiguity-spatial-weights">3.4.1 Computing Contiguity Spatial Weights</h3>
<p>We now generate the neighbours list.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>mys_nb_q <span class="ot">&lt;-</span> <span class="fu">st_contiguity</span>(crime_df_mys_grp, <span class="at">queen=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in spdep::poly2nb(geometry, queen = queen, ...): some observations have no neighbours;
if this seems unexpected, try increasing the snap argument.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in spdep::poly2nb(geometry, queen = queen, ...): neighbour object has 3 sub-graphs;
if this sub-graph count seems unexpected, try increasing the snap argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Langkawi has no immediate neighbours, hence its neighbour has to be manually added.</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>mys_nb_q[[<span class="dv">17</span>]] <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">c</span>(<span class="dv">18</span>))</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>mys_nb_q[[<span class="dv">18</span>]] <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">sort</span>(<span class="fu">unique</span>(<span class="fu">c</span>(mys_nb_q[[<span class="dv">18</span>]], <span class="dv">17</span>))))</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>mys_wm_rs <span class="ot">&lt;-</span> <span class="fu">st_weights</span>(mys_nb_q, <span class="at">style=</span><span class="st">"W"</span>)</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>wm_q <span class="ot">&lt;-</span> crime_df_mys_grp <span class="sc">%&gt;%</span></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nb =</span> mys_nb_q,</span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">wt =</span> mys_wm_rs,</span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">.before =</span> <span class="dv">1</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="morans-i-test" class="level3">
<h3 class="anchored" data-anchor-id="morans-i-test">3.4.2 Moranâ€™s I test</h3>
<p>The code chunk below performs Moranâ€™s I statistical testing using <a href="https://r-spatial.github.io/spdep/reference/moran.test.html"><code>moran.test()</code></a> of <strong>spdep</strong>. The primary goal of the test is to determine whether the spatial autocorrelation is positive, negative or non-existent.</p>
<p><strong>Null Hypothesis</strong> <span class="math inline">\(H_0:I\leq E[I]\)</span>. This suggests that there is either no spatial autocorrelation (<span class="math inline">\(I=E[I]\)</span>). or negative spatial autocorrelation (<span class="math inline">\(I&lt;E[I]\)</span>).</p>
<p><strong>Alternative Hypothesis</strong> <span class="math inline">\(H_0:I&gt; E[I]\)</span>. This indicates the presence of positive spatial autocorrelation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>moranI <span class="ot">&lt;-</span> <span class="fu">global_moran</span>(wm_q<span class="sc">$</span>total_crimes_pc,</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>                        wm_q<span class="sc">$</span>nb,</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>                        wm_q<span class="sc">$</span>wt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">global_moran_test</span>(wm_q<span class="sc">$</span>total_crimes_pc,</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>                  wm_q<span class="sc">$</span>nb,</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>                  wm_q<span class="sc">$</span>wt,</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">alternative =</span> <span class="st">"greater"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Moran I test under randomisation

data:  x  
weights: listw    

Moran I statistic standard deviate = 3.9166, p-value = 4.491e-05
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
      0.275786031      -0.011627907       0.005385229 </code></pre>
</div>
</div>
<p>Based on the Moranâ€™s I test, we can conclude that there is evidence of significant positive spatial autocorrelation in the crime data. This suggests that the distribution of crime in Malaysia is not random and that there are clusters of high and low crime rates.</p>
<ul>
<li><p>The Moranâ€™s I statistic is positive (0.271500147), suggesting a positive spatial autocorrelation in the crime data. This means that areas with similar crime rates tend to be located near each other.</p></li>
<li><p>The standard deviate of 3.8061 indicates the significance of the Moranâ€™s I statistic. A higher standard deviate suggests a stronger spatial pattern.</p></li>
<li><p>The p-value of 7.058e-05 is less than the significance level of 0.05, indicating that the observed spatial pattern is statistically significant. This means that it is unlikely to have occurred by chance.</p></li>
</ul>
<section id="performing-global-morans-i-permutation-test" class="level4">
<h4 class="anchored" data-anchor-id="performing-global-morans-i-permutation-test">3.4.2.1 Performing Global Moranâ€™s I permutation test</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>gmoranMC <span class="ot">&lt;-</span> <span class="fu">global_moran_perm</span>(wm_q<span class="sc">$</span>total_crimes_pc,</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>                  wm_q<span class="sc">$</span>nb,</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>                  wm_q<span class="sc">$</span>wt,</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">nsim =</span> <span class="dv">999</span>)</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>gmoranMC</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Monte-Carlo simulation of Moran I

data:  x 
weights: listw  
number of simulations + 1: 1000 

statistic = 0.27579, observed rank = 999, p-value = 0.002
alternative hypothesis: two.sided</code></pre>
</div>
</div>
<ul>
<li>We can observe that the Moranâ€™s I statistic is <strong>0.2715</strong> with a p-value <strong>&lt; 2.2e-16</strong>, which is similar to our previous result using <code>moran.test()</code>. It confirms that our result is stable.</li>
</ul>
</section>
<section id="visualising-monte-carlo-morans-i" class="level4">
<h4 class="anchored" data-anchor-id="visualising-monte-carlo-morans-i">3.4.2.2 Visualising Monte Carlo Moranâ€™s I</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(gmoranMC<span class="sc">$</span>res, <span class="at">main=</span><span class="st">"Histogram of Simulation Results"</span>, <span class="at">xlab=</span><span class="st">"Monte-Carlo Results"</span>, <span class="at">ylab=</span><span class="st">"Frequency"</span>)</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> gmoranMC<span class="sc">$</span>statistic, <span class="at">col =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="gearys-c-test" class="level3">
<h3 class="anchored" data-anchor-id="gearys-c-test">3.4.3 Gearyâ€™s C test</h3>
<p>The code chunk below performs Global Gearyâ€™s C test for spatial autocorrelation by using geary.test() of spdep.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">global_c_test</span>(wm_q<span class="sc">$</span>total_crimes_pc,</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>                  wm_q<span class="sc">$</span>nb,</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>                  wm_q<span class="sc">$</span>wt,</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">alternative =</span> <span class="st">"greater"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Geary C test under randomisation

data:  x 
weights: listw   

Geary C statistic standard deviate = 4.1574, p-value = 1.609e-05
alternative hypothesis: Expectation greater than statistic
sample estimates:
Geary C statistic       Expectation          Variance 
      0.645478034       1.000000000       0.007271778 </code></pre>
</div>
</div>
<p>The calculated Gearyâ€™s C statistic of <strong>0.649379732</strong> deviates from the expected value of 1, indicating a potential spatial pattern in the data. The associated p-value of <strong>2.155e-05</strong> is statistically significant at the 0.05 level, further supporting the conclusion that the observed spatial pattern is unlikely to be due to random chance. Therefore, we reject the null hypothesis of no spatial autocorrelation.</p>
<section id="monte-carlo-gearys-c" class="level4">
<h4 class="anchored" data-anchor-id="monte-carlo-gearys-c">3.4.3.1 Monte Carlo Gearyâ€™s C</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>bperm <span class="ot">&lt;-</span> <span class="fu">global_c_perm</span>(wm_q<span class="sc">$</span>total_crimes_pc,</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>                  wm_q<span class="sc">$</span>nb,</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>                  wm_q<span class="sc">$</span>wt,</span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">nsim =</span> <span class="dv">999</span>)</span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>bperm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Monte-Carlo simulation of Geary C

data:  x 
weights: listw  
number of simulations + 1: 1000 

statistic = 0.64548, observed rank = 1, p-value = 0.001
alternative hypothesis: greater</code></pre>
</div>
</div>
<p>It can be seen that the results are similar to the previous output of the code chunk. Hence our result is statistically significant.</p>
</section>
<section id="visualising-the-monte-carlo-gearys-c" class="level4">
<h4 class="anchored" data-anchor-id="visualising-the-monte-carlo-gearys-c">3.4.3.2 Visualising the Monte Carlo Gearyâ€™s C</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(bperm<span class="sc">$</span>res, </span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">freq=</span><span class="cn">TRUE</span>, <span class="at">breaks=</span><span class="dv">20</span>, </span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">"Simulated Geary c"</span>)</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="dv">1</span>, <span class="at">col=</span><span class="st">"red"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="local-measures-of-spatial-autocorrelation" class="level2">
<h2 class="anchored" data-anchor-id="local-measures-of-spatial-autocorrelation">3.5 Local Measures of Spatial Autocorrelation</h2>
<section id="computing-local-morans-i" class="level3">
<h3 class="anchored" data-anchor-id="computing-local-morans-i">3.5.1 Computing Local Moranâ€™s I</h3>
<p>To compute local Moranâ€™s I, the local_moran() function of <strong>sfdep</strong> will be used. It computes Ii values, given a set of zi values and a listw object providing neighbour weighting information for the polygon associated with the zi values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>lisa <span class="ot">&lt;-</span> wm_q <span class="sc">%&gt;%</span> </span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">local_moran =</span> <span class="fu">local_moran</span>(</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>    total_crimes_pc, nb, wt, <span class="at">nsim =</span> <span class="dv">99</span>),</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">.before =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(local_moran)</span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>lisa</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 87 features and 17 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 184853.1 ymin: 139843.3 xmax: 728635.8 ymax: 744607.2
Projected CRS: Kertau (RSO) / RSO Malaya (m)
# A tibble: 87 Ã— 18
        ii      eii  var_ii   z_ii   p_ii p_ii_sim p_folded_sim skewness
     &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;        &lt;dbl&gt;    &lt;dbl&gt;
 1  0.931   0.0733  0.224    1.81  0.0699     0.02         0.01   -0.776
 2 -0.639   0.00450 0.437   -0.974 0.330      0.24         0.12    0.978
 3  0.319  -0.0136  0.0529   1.44  0.148      0.04         0.02   -1.11 
 4  0.0148 -0.00278 0.00580  0.230 0.818      0.96         0.48   -0.785
 5  0.0716 -0.0366  0.0961   0.349 0.727      0.92         0.46   -0.596
 6  0.779  -0.0610  0.334    1.46  0.146      0.1          0.05   -0.625
 7  0.163   0.0101  0.0281   0.912 0.362      0.34         0.17   -0.331
 8  1.21   -0.0341  0.646    1.55  0.121      0.04         0.02   -0.858
 9  0.260   0.0210  0.249    0.479 0.632      0.76         0.38   -0.603
10  0.352  -0.0139  0.0349   1.96  0.0502     0.02         0.01   -0.764
# â„¹ 77 more rows
# â„¹ 10 more variables: kurtosis &lt;dbl&gt;, mean &lt;fct&gt;, median &lt;fct&gt;, pysal &lt;fct&gt;,
#   nb &lt;nb&gt;, wt &lt;list&gt;, state &lt;chr&gt;, district &lt;chr&gt;, total_crimes_pc &lt;dbl&gt;,
#   geometry &lt;MULTIPOLYGON [m]&gt;</code></pre>
</div>
</div>
<section id="visualising-local-morans-i" class="level4">
<h4 class="anchored" data-anchor-id="visualising-local-morans-i">3.5.1.1 Visualising Local Moranâ€™s I</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(lisa)<span class="sc">+</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"ii"</span>, </span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="fu">c</span>(<span class="st">"#b7dce9"</span>,<span class="st">"#e1ecbb"</span>,<span class="st">"#f5f3a6"</span>,</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"#f8d887"</span>,<span class="st">"#ec9a64"</span>,<span class="st">"#d21b1c"</span>),</span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Local Moran's I"</span>,</span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">midpoint =</span> <span class="cn">NA</span>,</span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.hist =</span> <span class="cn">TRUE</span>, </span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.is.portrait =</span> <span class="cn">TRUE</span>,</span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.hist.z =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="visualising-local-morans-i-p-value" class="level4">
<h4 class="anchored" data-anchor-id="visualising-local-morans-i-p-value">3.5.1.2 Visualising Local Moranâ€™s I p-value</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(lisa)<span class="sc">+</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"p_ii_sim"</span>, </span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="fu">c</span>(<span class="st">"#b7dce9"</span>,<span class="st">"#c9e3d2"</span>,<span class="st">"#f5f3a6"</span>,<span class="st">"#ec9a64"</span>,<span class="st">"#d21b1c"</span>),</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"p-value"</span>,</span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">midpoint =</span> <span class="cn">NA</span>,</span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.hist =</span> <span class="cn">TRUE</span>, </span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.is.portrait =</span> <span class="cn">TRUE</span>,</span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.hist.z =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="visualising-statistically-significant-local-spatial-autocorrelation-map" class="level4">
<h4 class="anchored" data-anchor-id="visualising-statistically-significant-local-spatial-autocorrelation-map">3.5.1.3 Visualising Statistically Significant Local Spatial Autocorrelation Map</h4>
<p>From the p-value map above, it appears that not every district exhibits a statistically significant Local Moranâ€™s value. We will thus filter out to focus our analysis will focus solely on districts with statistically significant values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>lisa_sig <span class="ot">&lt;-</span> lisa  <span class="sc">%&gt;%</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(p_ii_sim <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(lisa)<span class="sc">+</span></span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>() <span class="sc">+</span></span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>)<span class="sc">+</span></span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(lisa_sig)<span class="sc">+</span></span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"ii"</span>, </span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="fu">c</span>(<span class="st">"#b7dce9"</span>,<span class="st">"#e1ecbb"</span>,<span class="st">"#f5f3a6"</span>,</span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"#f8d887"</span>,<span class="st">"#ec9a64"</span>,<span class="st">"#d21b1c"</span>),</span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Local Moran's I (p &lt; 0.05)"</span>,</span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a>          <span class="at">midpoint =</span> <span class="cn">NA</span>,</span>
<span id="cb106-13"><a href="#cb106-13" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.hist =</span> <span class="cn">TRUE</span>, </span>
<span id="cb106-14"><a href="#cb106-14" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.is.portrait =</span> <span class="cn">TRUE</span>,</span>
<span id="cb106-15"><a href="#cb106-15" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.hist.z =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb106-16"><a href="#cb106-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: One tm layer group has duplicated layer types, which are omitted. To
draw multiple layers of the same type, use multiple layer groups (i.e. specify
tm_shape prior to each of them).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="lisa-classification" class="level3">
<h3 class="anchored" data-anchor-id="lisa-classification">3.5.2 LISA Classification</h3>
<p>Specific to our study, we may infer LISA classifications as below.</p>
<pre><code>High-Low Outliers: districts with a high value of crime per capita, surrounded by districts with low values of crime per capita

Low-High Outliers: districts with a low value of crime per capita, surrounded by neighbouring districts with high values of crime per capita

High-High Clusters: districts with a high value of crime per capita, surrounded by neighbouring districts with high values of crime per capita

Low-Low Clusters: districts with a low value of crime per capita, surrounded by neighbouring districts with low values of crime per capita</code></pre>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>tmap mode set to plotting</code></pre>
</div>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>study_area_lisa <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(lisa)<span class="sc">+</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>() <span class="sc">+</span></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>)<span class="sc">+</span></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(lisa_sig)<span class="sc">+</span></span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"mean"</span>, </span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="fu">c</span>(<span class="st">"#b7dce9"</span>,<span class="st">"#ec9a64"</span>,<span class="st">"#e1ecbb"</span>, <span class="st">"#d21b1c"</span>),</span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"LISA class"</span>,</span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">midpoint =</span> <span class="cn">NA</span>,</span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.hist =</span> <span class="cn">TRUE</span>, </span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.is.portrait =</span> <span class="cn">TRUE</span>,</span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.hist.z =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb111-12"><a href="#cb111-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>)</span>
<span id="cb111-13"><a href="#cb111-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-14"><a href="#cb111-14" aria-hidden="true" tabindex="-1"></a>study_area_lisa</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: One tm layer group has duplicated layer types, which are omitted. To
draw multiple layers of the same type, use multiple layer groups (i.e. specify
tm_shape prior to each of them).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="hot-and-cold-spots-analysis-hcsa" class="level2">
<h2 class="anchored" data-anchor-id="hot-and-cold-spots-analysis-hcsa">3.6 Hot and Cold Spots Analysis (HCSA)</h2>
<p>The Gi and Gi* measures are typically reported as a z-score where high values indicate a high-high cluster, and negative z-scores indicate a low-low cluster. There are no high-low and low-high classifications like the local Moran.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>wm_idw <span class="ot">&lt;-</span> crime_df_mys_grp <span class="sc">%&gt;%</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nb =</span> <span class="fu">include_self</span>(<span class="fu">st_contiguity</span>(geometry)),</span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">wt =</span> <span class="fu">st_inverse_distance</span>(nb, geometry,</span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">scale =</span> <span class="dv">1</span>,</span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">alpha =</span> <span class="dv">1</span>),</span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">.before =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>! Polygon provided. Using point on surface.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There were 2 warnings in `stopifnot()`.
The first warning was:
â„¹ In argument: `nb = include_self(st_contiguity(geometry))`.
Caused by warning in `spdep::poly2nb()`:
! some observations have no neighbours;
if this seems unexpected, try increasing the snap argument.
â„¹ Run `dplyr::last_dplyr_warnings()` to see the 1 remaining warning.</code></pre>
</div>
</div>
<p>Next, we will calculate local using local_gstart_perm() function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>HCSA <span class="ot">&lt;-</span> wm_idw <span class="sc">%&gt;%</span> </span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">local_Gi_star =</span> <span class="fu">local_gstar_perm</span>(</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>    total_crimes_pc, nb, wt, <span class="at">nsim =</span> <span class="dv">99</span>),</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">.before =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(local_Gi_star)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>tmap mode set to plotting</code></pre>
</div>
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(HCSA)<span class="sc">+</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"gi_star"</span>, </span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="fu">c</span>(<span class="st">"#57bfc0"</span>, <span class="st">"#7977f3"</span>,<span class="st">"#f8d673"</span>,<span class="st">"#f8b675"</span>,<span class="st">"#f67774"</span>),</span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Gi*"</span>,</span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">midpoint =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Similar to what we did for the LISA map, we choose to narrow our focus onto districts with statistically significant Gi* values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>HCSA_sig <span class="ot">&lt;-</span> HCSA  <span class="sc">%&gt;%</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(p_sim <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>tmap mode set to plotting</code></pre>
</div>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(HCSA) <span class="sc">+</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>() <span class="sc">+</span></span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(HCSA_sig)<span class="sc">+</span></span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"gi_star"</span>, </span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="fu">c</span>(<span class="st">"#57bfc0"</span>, <span class="st">"#7977f3"</span>,<span class="st">"#f8d673"</span>,<span class="st">"#f8b675"</span>,<span class="st">"#f67774"</span>),</span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Gi*"</span>,</span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">midpoint =</span> <span class="dv">0</span>,</span>
<span id="cb122-8"><a href="#cb122-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.hist =</span> <span class="cn">TRUE</span>, </span>
<span id="cb122-9"><a href="#cb122-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.is.portrait =</span> <span class="cn">TRUE</span>,</span>
<span id="cb122-10"><a href="#cb122-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.hist.z =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb122-11"><a href="#cb122-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>three_hotspots <span class="ot">&lt;-</span> (<span class="fu">head</span>((HCSA_sig[HCSA_sig<span class="sc">$</span>gi_star <span class="sc">&gt;</span> <span class="dv">2</span>,]), <span class="dv">3</span>)<span class="sc">$</span>district)</span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>three_coldspots <span class="ot">&lt;-</span>  (<span class="fu">head</span>((HCSA_sig[HCSA_sig<span class="sc">$</span>gi_star <span class="sc">&gt;</span> <span class="sc">-</span><span class="dv">2</span>,]), <span class="dv">3</span>)<span class="sc">$</span>district)</span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a>three_hotspots</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "WP. KUALA LUMPUR" "S.P. UTARA"       "GOMBAK"          </code></pre>
</div>
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>three_coldspots</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "BATU PAHAT" "MUAR"       "JELI"      </code></pre>
</div>
</div>
</section>
</section>
<section id="conclusion" class="level1">
<h1>4. Conclusion</h1>
<p>It was exciting to apply my research skills to a real-world data analysis project. By diving into the world of data visualization, I had fun with attempts of transforming complex information into compelling stories. This experience has ignited my enthusiasm for data-driven decision-making, and I look forward to further continue working on this exercise in the project.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>